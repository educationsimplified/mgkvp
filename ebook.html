<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CASE STUDY BOOKS FROM (IIMs, ISB and More..)</title>
  <meta name="description" content="Private e‑book reader for case study PDFs embedded from Google Drive" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg': '#0b0d12',
            'card': '#121622',
            'muted': '#7e8aa7',
            'text': '#e8ecf8',
            'brand': '#4f7cff',
            'brand-2': '#6ce4ff',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: radial-gradient(1200px 600px at 10% -10%, rgba(79,124,255,.25), transparent 60%),
                  radial-gradient(900px 500px at 90% -20%, rgba(108,228,255,.18), transparent 60%),
                  #0b0d12;
    }
  </style>
</head>
<body class="font-sans text-text antialiased">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <header class="flex flex-col sm:flex-row items-center justify-between mb-5">
      <div class="text-center sm:text-left">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold leading-tight mb-1">CASE STUDY BOOKS FROM (IIMs, ISB and More..)</h1>
        <p class="text-sm sm:text-base text-muted font-medium mb-4 sm:mb-0">Private reader (embedded PDFs from Google Drive). Choose from dropdown or click a card to read in fullscreen.</p>
      </div>
      <div class="flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto mt-4 sm:mt-0">
        <select id="bookSelect" aria-label="Select a book" class="min-w-[150px] sm:min-w-[420px] p-3 rounded-xl border border-[#27304a] bg-[#0f1320] text-text outline-none focus:ring-2 focus:ring-brand focus:border-transparent transition-colors duration-200">
          <option value="">— Select a book —</option>
        </select>
        <button class="open-select px-4 py-3 rounded-xl bg-gradient-to-r from-brand to-brand-2 text-[#081020] font-extrabold cursor-pointer w-full sm:w-auto hover:opacity-90 transition-opacity duration-200" id="openSelected">Open</button>
      </div>
    </header>

    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-5" id="grid" aria-live="polite"></section>

    <footer class="mt-7 text-muted text-sm flex flex-col sm:flex-row justify-center items-center gap-2 pt-4 border-t border-[#1e2742] text-center">
      <span>Journalism Wallah 2025</span>
      <span class="hidden sm:inline">•</span>
      <span>Made by Uzair B2B Services</span>
    </footer>
  </div>

  <div class="overlay fixed inset-0 hidden bg-[#02050bbf] backdrop-blur-sm z-50" id="overlay"></div>
  <div class="reader fixed inset-5 sm:inset-10 hidden flex-col bg-[#0b0f1b] border border-[#1e2742] rounded-[20px] overflow-hidden z-[60] shadow-2xl shadow-black/50" id="reader" role="dialog" aria-modal="true" aria-label="Book reader">
    <div class="bar flex items-center justify-between p-3 bg-[#0e1322] border-b border-[#1e2742]">
      <div class="flex flex-wrap sm:flex-nowrap items-center gap-2 sm:gap-4">
        <button class="btn px-3 py-2 border border-[#27304a] bg-[#12172a] text-[#dbe2ff] rounded-xl cursor-pointer hover:bg-[#1a1f33] transition-colors duration-200" id="backBtn" title="Back to library">⟵ Library</button>
        <span id="bookTitle" class="text-sm sm:text-base opacity-90 truncate max-w-[200px] sm:max-w-none"></span>
      </div>
      <div class="flex items-center gap-2">
        <button class="btn px-3 py-2 border border-[#27304a] bg-[#12172a] text-[#dbe2ff] rounded-xl cursor-pointer hover:bg-[#1a1f33] transition-colors duration-200 hidden sm:block" id="prevBtn" title="Previous book">Prev</button>
        <button class="btn px-3 py-2 border border-[#27304a] bg-[#12172a] text-[#dbe2ff] rounded-xl cursor-pointer hover:bg-[#1a1f33] transition-colors duration-200 hidden sm:block" id="nextBtn" title="Next book">Next</button>
        <button class="btn px-3 py-2 border border-[#27304a] bg-[#12172a] text-[#dbe2ff] rounded-xl cursor-pointer hover:bg-[#1a1f33] transition-colors duration-200" id="fsBtn" title="Toggle Fullscreen">⤢ Fullscreen</button>
        <button class="btn primary px-3 py-2 border-0 bg-gradient-to-r from-brand to-brand-2 text-[#081020] font-extrabold rounded-xl cursor-pointer hover:opacity-90 transition-opacity duration-200" id="closeBtn" title="Close">Close</button>
      </div>
    </div>
    <iframe id="viewer" allow="fullscreen" referrerpolicy="no-referrer" class="flex-1 w-full h-full border-0 bg-[#0b0f1b]"></iframe>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    // ====== CONFIG: Google Sheets CSV (Published) ======
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOVT-iw_jiz5AmAK_3g6fZiNR_MM3oEqlCgUEJAfGB46Hxi4tag8xke8HtD6G9RNFOoO2SX2O_FPna/pub?gid=1891377461&single=true&output=csv";

    let BOOKS = [];

    // Build a Drive preview URL
    const drivePreview = (id) => `https://drive.google.com/file/d/${id}/preview`;

    // Robust fileId extractor from Drive links
    function extractIdFromUrl(url) {
      if (!url) return null;
      const m = String(url).match(/\/(?:file)?\/d\/([\w-]+)/);
      return m ? m[1] : null;
    }

    // ====== DOM refs ======
    const grid = document.getElementById('grid');
    const select = document.getElementById('bookSelect');
    const openSelectedBtn = document.getElementById('openSelected');

    // ====== Renderers ======
    function renderGrid(list) {
      grid.innerHTML = '';
      list.forEach((b, idx) => {
        const card = document.createElement('article');
        card.className = 'card bg-gradient-to-b from-[#151a2a] to-[#0f1320] border border-[#1e2742] rounded-[18px] p-4 flex flex-col gap-2 shadow-lg hover:-translate-y-0.5 hover:shadow-xl transition-all duration-150 ease-in-out';
        card.innerHTML = `
          <span class="tag text-xs text-[#a8b3cf] bg-[#0a0d17] border border-[#1e2742] rounded-full px-2 py-1 w-max">Case Book</span>
          <h3 class="mt-0 mb-0 font-medium text-lg">${b.title}</h3>
          <p class="mt-0 mb-0 text-sm text-[#93a0bf]">Click to read in fullscreen</p>
          <button class="mt-auto px-4 py-3 border-0 rounded-xl bg-gradient-to-r from-brand to-brand-2 text-[#081020] font-extrabold cursor-pointer hover:opacity-90 transition-opacity duration-200" data-idx="${idx}">Open</button>
        `;
        card.querySelector('button').addEventListener('click', () => openReader(idx));
        card.addEventListener('dblclick', () => openReader(idx));
        grid.appendChild(card);
      });
    }

    function renderSelect(list) {
      // Clear existing except placeholder
      select.innerHTML = '<option value="">— Select a book —</option>';
      list.forEach((b, idx) => {
        const opt = document.createElement('option');
        opt.value = String(idx);
        opt.textContent = b.title;
        select.appendChild(opt);
      });
    }

    openSelectedBtn.addEventListener('click', () => {
      const idx = parseInt(select.value, 10);
      if (!Number.isNaN(idx)) openReader(idx);
    });
    select.addEventListener('change', () => {
      const idx = parseInt(select.value, 10);
      if (!Number.isNaN(idx)) openReader(idx);
    });

    // ====== Load CSV dynamically ======
    Papa.parse(CSV_URL, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        BOOKS = (results.data || [])
          .map(row => ({
            title: (row["BOOK NAME"] || '').trim(),
            fileId: extractIdFromUrl(row["BOOK DRIVE LINK"]) || ''
          }))
          .filter(b => b.title && b.fileId);

        renderSelect(BOOKS);
        renderGrid(BOOKS);
      }
    });

    // ====== Reader Overlay Logic ======
    const overlay = document.getElementById('overlay');
    const reader = document.getElementById('reader');
    const viewer = document.getElementById('viewer');
    const bookTitleEl = document.getElementById('bookTitle');
    const closeBtn = document.getElementById('closeBtn');
    const backBtn = document.getElementById('backBtn');
    const fsBtn = document.getElementById('fsBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    let currentIndex = -1;

    function openReader(idx) {
      currentIndex = idx;
      const book = BOOKS[idx];
      if (!book) return;
      bookTitleEl.textContent = book.title;
      viewer.src = drivePreview(book.fileId);
      overlay.classList.remove('hidden');
      reader.classList.remove('hidden');
      requestFs(reader);
      localStorage.setItem('lastOpenBook', String(idx));
    }

    function closeReader() {
      viewer.src = '';
      overlay.classList.add('hidden');
      reader.classList.add('hidden');
      exitFs();
    }

    function requestFs(el) {
      const fn = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
      if (fn) try {
        fn.call(el);
      } catch (e) {}
    }

    function exitFs() {
      const fn = document.exitFullscreen || document.webkitExitFullscreen || document.msExitFullscreen;
      if (fn) try {
        fn.call(document);
      } catch (e) {}
    }

    closeBtn.addEventListener('click', closeReader);
    backBtn.addEventListener('click', closeReader);
    fsBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        requestFs(reader);
      } else {
        exitFs();
      }
    });

    prevBtn.addEventListener('click', () => navigate(-1));
    nextBtn.addEventListener('click', () => navigate(1));

    function navigate(delta) {
      if (currentIndex < 0) return;
      let i = (currentIndex + delta + BOOKS.length) % BOOKS.length;
      openReader(i);
      select.value = String(i);
    }

    // ====== Anti casual sharing (front‑end only; NOT real DRM) ======
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if ((e.ctrlKey || e.metaKey) && (k === 's' || k === 'p' || k === 'c')) {
        e.preventDefault();
        e.stopPropagation();
      }
    }, true);
  </script>
</body>
</html>
