<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CASE STUDY BOOKS FROM (IIMs, ISB and More..)</title>
  <meta name="description" content="Private e‑book reader for case study PDFs embedded from Google Drive" />
  <style>
    :root{
      --bg:#0b0d12; --card:#121622; --muted:#7e8aa7; --text:#e8ecf8; --brand:#4f7cff; --brand-2:#6ce4ff;
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 10% -10%, rgba(79,124,255,.25), transparent 60%),
                       radial-gradient(900px 500px at 90% -20%, rgba(108,228,255,.18), transparent 60%),
                       var(--bg);color:var(--text);font:500 16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}

    .wrap{max-width:1200px;margin:0 auto;padding:32px}

    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
    .title{font-size:clamp(22px,3.3vw,38px);line-height:1.15;margin:0}
    .subtitle{margin:6px 0 0;color:var(--muted);font-weight:500}

    .actions{display:flex;gap:10px;align-items:center}
    select#bookSelect{min-width:min(68vw,420px);padding:12px 14px;border-radius:12px;border:1px solid #27304a;background:#0f1320;color:var(--text);outline:none}
    .open-select{padding:10px 12px;border:0;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#081020;font-weight:800;cursor:pointer}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:18px}

    .card{background:linear-gradient(180deg,#151a2a,#0f1320);border:1px solid #1e2742;border-radius:var(--radius);padding:16px;display:flex;flex-direction:column;gap:10px;box-shadow:0 8px 24px rgba(0,0,0,.25);transition:transform .12s ease, box-shadow .12s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 14px 34px rgba(0,0,0,.35)}
    .tag{font-size:12px;color:#a8b3cf;background:#0a0d17;border:1px solid #1e2742;border-radius:999px;padding:4px 8px;width:max-content}
    .card h3{margin:0;font-size:17px}
    .card p{margin:0;color:#93a0bf;font-size:14px}
    .card button{margin-top:auto;padding:10px 12px;border:0;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#081020;font-weight:800;cursor:pointer}

    /* Fullscreen Reader */
    .overlay{position:fixed;inset:0;display:none;background:#02050bbf;backdrop-filter:blur(3px);z-index:50}
    .reader{position:fixed;inset:20px;display:flex;flex-direction:column;background:#0b0f1b;border:1px solid #1e2742;border-radius:20px;overflow:hidden;z-index:60;box-shadow:0 30px 80px rgba(0,0,0,.5)}
    .reader.hidden{display:none}
    .reader .bar{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:10px 12px;background:#0e1322;border-bottom:1px solid #1e2742}
    .reader .bar .left{display:flex;gap:10px;align-items:center}
    .reader .bar .right{display:flex;gap:8px;align-items:center}
    .btn{padding:8px 11px;border:1px solid #27304a;background:#12172a;color:#dbe2ff;border-radius:12px;cursor:pointer}
    .btn.primary{border:0;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#081020;font-weight:800}
    .btn.ghost{background:transparent}
    .reader iframe{flex:1;width:100%;height:100%;border:0;background:#0b0f1b}

    footer{margin-top:28px;color:#a7b2cf;font-size:14px;display:flex;justify-content:center;gap:8px;align-items:center;border-top:1px solid #1e2742;padding-top:16px}

    @media (max-width:640px){
      .reader{inset:10px}
      select#bookSelect{min-width:66vw}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1 class="title">CASE STUDY BOOKS FROM (IIMs, ISB and More..)</h1>
        <p class="subtitle">Private reader (embedded PDFs from Google Drive). Choose from dropdown or click a card to read in fullscreen.</p>
      </div>
      <div class="actions">
        <select id="bookSelect" aria-label="Select a book">
          <option value="">— Select a book —</option>
        </select>
        <button class="open-select" id="openSelected">Open</button>
      </div>
    </header>

    <section class="grid" id="grid" aria-live="polite"></section>

    <footer>
      <span>Journalism Wallah 2025</span>
      <span>•</span>
      <span>Made by Uzair B2B Services</span>
    </footer>
  </div>

  <!-- Overlaid Reader -->
  <div class="overlay" id="overlay"></div>
  <div class="reader hidden" id="reader" role="dialog" aria-modal="true" aria-label="Book reader">
    <div class="bar">
      <div class="left">
        <button class="btn" id="backBtn" title="Back to library">⟵ Library</button>
        <span id="bookTitle" style="opacity:.9"></span>
      </div>
      <div class="right">
        <button class="btn" id="prevBtn" title="Previous book">Prev</button>
        <button class="btn" id="nextBtn" title="Next book">Next</button>
        <button class="btn" id="fsBtn" title="Toggle Fullscreen">⤢ Fullscreen</button>
        <button class="btn primary" id="closeBtn" title="Close">Close</button>
      </div>
    </div>
    <iframe id="viewer" allow="fullscreen" referrerpolicy="no-referrer"></iframe>
  </div>

  <!-- CSV parser -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    // ====== CONFIG: Google Sheets CSV (Published) ======
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOVT-iw_jiz5AmAK_3g6fZiNR_MM3oEqlCgUEJAfGB46Hxi4tag8xke8HtD6G9RNFOoO2SX2O_FPna/pub?gid=1891377461&single=true&output=csv";

    let BOOKS = [];

    // Build a Drive preview URL
    const drivePreview = (id) => `https://drive.google.com/file/d/${id}/preview`;

    // Robust fileId extractor from Drive links
    function extractIdFromUrl(url){
      if(!url) return null;
      const m = String(url).match(/\/(?:file)?\/d\/([\w-]+)/);
      return m ? m[1] : null;
    }

    // ====== DOM refs ======
    const grid = document.getElementById('grid');
    const select = document.getElementById('bookSelect');
    const openSelectedBtn = document.getElementById('openSelected');

    // ====== Renderers ======
    function renderGrid(list){
      grid.innerHTML = '';
      list.forEach((b, idx) => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <span class="tag">Case Book</span>
          <h3>${b.title}</h3>
          <p>Click to read in fullscreen</p>
          <button data-idx="${idx}">Open</button>
        `;
        card.querySelector('button').addEventListener('click', () => openReader(idx));
        card.addEventListener('dblclick', () => openReader(idx));
        grid.appendChild(card);
      });
    }

    function renderSelect(list){
      // Clear existing except placeholder
      select.innerHTML = '<option value="">— Select a book —</option>';
      list.forEach((b, idx) => {
        const opt = document.createElement('option');
        opt.value = String(idx);
        opt.textContent = b.title;
        select.appendChild(opt);
      });
    }

    openSelectedBtn.addEventListener('click', () => {
      const idx = parseInt(select.value, 10);
      if(!Number.isNaN(idx)) openReader(idx);
    });
    select.addEventListener('change', () => {
      const idx = parseInt(select.value, 10);
      if(!Number.isNaN(idx)) openReader(idx);
    });

    // ====== Load CSV dynamically ======
    Papa.parse(CSV_URL, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        BOOKS = (results.data || [])
          .map(row => ({
            title: (row["BOOK NAME"] || '').trim(),
            fileId: extractIdFromUrl(row["BOOK DRIVE LINK"]) || ''
          }))
          .filter(b => b.title && b.fileId);

        renderSelect(BOOKS);
        renderGrid(BOOKS);
      }
    });

    // ====== Reader Overlay Logic ======
    const overlay = document.getElementById('overlay');
    const reader  = document.getElementById('reader');
    const viewer  = document.getElementById('viewer');
    const bookTitleEl = document.getElementById('bookTitle');
    const closeBtn = document.getElementById('closeBtn');
    const backBtn  = document.getElementById('backBtn');
    const fsBtn    = document.getElementById('fsBtn');
    const prevBtn  = document.getElementById('prevBtn');
    const nextBtn  = document.getElementById('nextBtn');

    let currentIndex = -1;

    function openReader(idx){
      currentIndex = idx;
      const book = BOOKS[idx];
      if(!book) return;
      bookTitleEl.textContent = book.title;
      viewer.src = drivePreview(book.fileId);
      overlay.style.display = 'block';
      reader.classList.remove('hidden');
      requestFs(reader);
      localStorage.setItem('lastOpenBook', String(idx));
    }

    function closeReader(){
      viewer.src = '';
      overlay.style.display = 'none';
      reader.classList.add('hidden');
      exitFs();
    }

    function requestFs(el){
      const fn = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
      if(fn) try{ fn.call(el); }catch(e){}
    }
    function exitFs(){
      const fn = document.exitFullscreen || document.webkitExitFullscreen || document.msExitFullscreen;
      if(fn) try{ fn.call(document); }catch(e){}
    }

    closeBtn.addEventListener('click', closeReader);
    backBtn .addEventListener('click', closeReader);
    fsBtn   .addEventListener('click', () => {
      if(!document.fullscreenElement){ requestFs(reader); }
      else{ exitFs(); }
    });

    prevBtn.addEventListener('click', () => navigate(-1));
    nextBtn.addEventListener('click', () => navigate(1));
    function navigate(delta){
      if(currentIndex < 0) return;
      let i = (currentIndex + delta + BOOKS.length) % BOOKS.length;
      openReader(i);
      select.value = String(i);
    }

    // ====== Anti casual sharing (front‑end only; NOT real DRM) ======
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if ((e.ctrlKey || e.metaKey) && (k === 's' || k === 'p' || k === 'c')) {
        e.preventDefault();
        e.stopPropagation();
      }
    }, true);
  </script>
</body>
</html>
